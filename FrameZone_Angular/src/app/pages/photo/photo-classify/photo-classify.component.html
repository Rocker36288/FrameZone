<div class="container-xl">
  <!-- 頁面標題 -->
  <div class="page-header d-print-none">
    <div class="row g-2 align-items-center">
      <div class="col">
        <h2 class="page-title">
          <i class="ti ti-photo-up me-2"></i>
          照片上傳與分類
        </h2>
        <div class="text-secondary mt-1">
          上傳照片後系統將自動解析 EXIF 資訊並進行智慧分類
        </div>
      </div>

      <!-- 操作按鈕區 -->
      <div class="col-auto ms-auto">
        <div class="btn-list">
          <button class="btn btn-primary" [disabled]="isUploading() || pendingFilesCount() === 0"
            (click)="startBatchUpload()">
            @if (isUploading()) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            上傳中...
            } @else {
            <i class="ti ti-upload me-2"></i>
            開始批次上傳 ({{ pendingFilesCount() }})
            }
          </button>

          <button class="btn btn-outline-danger" [disabled]="isUploading()" (click)="clearAll()">
            <i class="ti ti-trash me-2"></i>
            清空列表
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="page-body">
    <!-- 統計卡片區 - 固定顯示 -->
    <div class="row g-3 mb-3">
      <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-blue text-white avatar">
                  <i class="ti ti-photo"></i>
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">總檔案數</div>
                <div class="text-secondary">Total Files</div>
              </div>
              <div class="col-auto">
                <div class="display-6 text-blue">{{ uploadFiles().length }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-success text-white avatar">
                  <i class="ti ti-check"></i>
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">上傳成功</div>
                <div class="text-secondary">Success</div>
              </div>
              <div class="col-auto">
                <div class="display-6 text-success">{{ successCount() }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-danger text-white avatar">
                  <i class="ti ti-x"></i>
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">上傳失敗</div>
                <div class="text-secondary">Failed</div>
              </div>
              <div class="col-auto">
                <div class="display-6 text-danger">{{ failedCount() }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-lg-3">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-secondary text-white avatar">
                  <i class="ti ti-clock"></i>
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">等待上傳</div>
                <div class="text-secondary">Pending</div>
              </div>
              <div class="col-auto">
                <div class="display-6 text-secondary">{{ pendingFilesCount() }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 主要內容區：左右分欄 -->
    <div class="row g-3">
      <!-- 左側：上傳區域 -->
      <div class="col-lg-8">
        <div class="card upload-card">
          <div class="card-body">
            <div class="upload-zone" [class.dragging]="isDragging()" (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
              <div class="text-center">
                <i class="ti ti-cloud-upload display-1 text-muted mb-3"></i>
                <h3 class="mb-2">拖放照片到這裡</h3>
                <p class="text-secondary mb-3">
                  或點擊下方按鈕選擇檔案
                </p>

                <label class="btn btn-primary">
                  <i class="ti ti-file-plus me-2"></i>
                  選擇照片
                  <input type="file" multiple accept="image/*,.heic,.heif,.jpg,.jpeg,.png,.gif,.bmp"
                    (change)="onFileSelect($event)" style="display:none;">

                </label>

                <div class="mt-3 text-secondary small">
                  支援格式: JPG, PNG, HEIC, GIF, BMP (最大 50MB)
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 右側：上傳清單 -->
      <div class="col-lg-4">
        <div class="card upload-list-card">
          <div class="card-header">
            <h3 class="card-title">上傳清單</h3>
          </div>
          <div class="card-body p-0">
            @if (uploadFiles().length > 0) {
            <div class="upload-list">
              @for (fileItem of uploadFiles(); track fileItem.fileName; let i = $index) {
              <div class="upload-list-item">
                <div class="d-flex align-items-start gap-3">
                  <!-- 縮圖 -->
                  <div class="upload-list-thumbnail">
                    @if (fileItem.preview) {
                    <img [src]="fileItem.preview" alt="preview">
                    } @else {
                    <div class="upload-list-thumbnail-placeholder">
                      <i class="ti ti-photo"></i>
                    </div>
                    }
                  </div>

                  <!-- 檔案資訊 -->
                  <div class="flex-fill">
                    <div class="upload-list-filename">{{ fileItem.fileName }}</div>
                    <div class="upload-list-filesize">{{ formatFileSize(fileItem.fileSize) }}</div>
                    <div class="upload-list-status">
                      <i [class]="getStatusIconClass(fileItem.status)"></i>
                      <span [class]="getStatusTextClass(fileItem.status)">
                        {{ getStatusText(fileItem.status) }}
                      </span>
                    </div>
                    @if (fileItem.error) {
                    <div class="upload-list-error">{{ fileItem.error }}</div>
                    }
                  </div>

                  <!-- 刪除按鈕 -->
                  @if (fileItem.status !== 'uploading') {
                  <button class="btn btn-sm btn-ghost-danger" (click)="removeFile(i)" title="移除">
                    <i class="ti ti-trash"></i>
                  </button>
                  } @else {
                  <div class="spinner-border spinner-border-sm text-primary"></div>
                  }
                </div>

                <!-- 進度條 -->
                @if (fileItem.status === 'uploading' && fileItem.progress > 0) {
                <div class="progress mt-2" style="height: 3px;">
                  <div class="progress-bar" [style.width.%]="fileItem.progress"></div>
                </div>
                }
              </div>
              }
            </div>
            } @else {
            <div class="empty-list">
              <i class="ti ti-photo-off text-muted mb-2"></i>
              <p class="text-secondary mb-0">尚未加入任何照片</p>
            </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
