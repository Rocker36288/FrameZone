<div class="notifications-container">
  <!-- 頁面標題 -->
  <div class="page-header">
    <h2>通知設定</h2>
    <p>管理您接收通知的方式與內容偏好</p>
  </div>

  <!-- 成功訊息 -->
  @if (successMessage) {
    <div class="alert alert-success">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      {{ successMessage }}
      <button class="alert-close" (click)="successMessage = ''">×</button>
    </div>
  }

  <!-- 錯誤訊息 -->
  @if (errorMessage) {
    <div class="alert alert-error">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      {{ errorMessage }}
      <button class="alert-close" (click)="errorMessage = ''">×</button>
    </div>
  }

  <!-- 載入中 -->
  @if (isLoading) {
    <div class="loading-card">
      <div class="spinner"></div>
      <p>載入中...</p>
    </div>
  }

  <!-- 通知設定表單 -->
  @if (!isLoading && preferences) {
    <form (ngSubmit)="savePreferences()">

      <!-- 快捷操作按鈕 -->
      <div class="quick-actions">
        <button type="button" class="btn-quick" (click)="enableAll()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          全部開啟
        </button>
        <button type="button" class="btn-quick" (click)="disableAll()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          全部關閉
        </button>
      </div>

      <!-- 通知方式 -->
      <div class="section">
        <h3 class="section-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          通知方式
        </h3>
        <p class="section-description">選擇您接收通知的方式</p>

        <div class="settings-list">
          <!-- Email 通知 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">📧</div>
              <div class="setting-content">
                <h4 class="setting-title">電子郵件通知</h4>
                <p class="setting-description">透過電子郵件接收重要通知</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.emailNotification"
                name="emailNotification"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- SMS 通知 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">📱</div>
              <div class="setting-content">
                <h4 class="setting-title">簡訊通知</h4>
                <p class="setting-description">透過手機簡訊接收緊急通知</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.smsNotification"
                name="smsNotification"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- Push 通知 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">🔔</div>
              <div class="setting-content">
                <h4 class="setting-title">推播通知</h4>
                <p class="setting-description">在瀏覽器或 App 中接收即時推播</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.pushNotification"
                name="pushNotification"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- 內容偏好 -->
      <div class="section">
        <h3 class="section-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          內容偏好
        </h3>
        <p class="section-description">選擇您想要接收的通知內容</p>

        <div class="settings-list">
          <!-- 訂單更新 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">📦</div>
              <div class="setting-content">
                <h4 class="setting-title">訂單更新</h4>
                <p class="setting-description">訂單狀態變更、出貨通知等</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.orderUpdate"
                name="orderUpdate"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- 系統公告 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">📢</div>
              <div class="setting-content">
                <h4 class="setting-title">系統公告</h4>
                <p class="setting-description">系統維護、功能更新等重要訊息</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.systemAnnouncement"
                name="systemAnnouncement"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- 行銷郵件 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">💌</div>
              <div class="setting-content">
                <h4 class="setting-title">行銷郵件</h4>
                <p class="setting-description">產品推薦、新品上市等行銷資訊</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.marketingEmail"
                name="marketingEmail"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- 促銷通知 -->
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-icon">🎁</div>
              <div class="setting-content">
                <h4 class="setting-title">促銷通知</h4>
                <p class="setting-description">優惠活動、折扣碼等促銷訊息</p>
              </div>
            </div>
            <label class="toggle">
              <input
                type="checkbox"
                [(ngModel)]="form.promotionAlert"
                name="promotionAlert"
                (change)="markAsChanged()"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- 最後更新時間 -->
      @if (preferences.updatedAt) {
        <div class="last-updated">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          最後更新時間：{{ formatDateTime(preferences.updatedAt) }}
        </div>
      }

      <!-- 操作按鈕 -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="resetForm()"
          [disabled]="!hasChanges || isSaving"
        >
          取消
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!hasChanges || isSaving"
        >
          @if (isSaving) {
            <span class="spinner"></span>
            儲存中...
          } @else {
            儲存設定
          }
        </button>
      </div>
    </form>
  }
</div>
