<!-- BEGIN USER MENU / LOGIN BUTTON -->
@if (isLoggedIn) {
<!-- 已登入：顯示頭像下拉選單 -->
<div class="nav-item dropdown">
  <a href="#" (click)="toggleDropdown(); $event.preventDefault()" class="nav-link d-flex lh-1 p-0 px-2"
    aria-label="Open user menu" [class.show]="isDropdownOpen">
    <span class="avatar avatar-sm" [style.background-image]="'url(' + getUserAvatar() + ')'">
    </span>
  </a>
  <div class="dropdown-menu dropdown-menu-end" [class.show]="isDropdownOpen">
    <!-- 使用者資訊 -->
    <a href="javascript:void(0)" class="dropdown-item d-flex align-items-center gap-2">
      <span class="avatar avatar-sm">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
          <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0"></path>
          <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
        </svg>
      </span>
      <div>
        <div class="fw-bold">{{ displayUserName }}</div>
        <div class="text-muted small">{{ userSession.email }}</div>
      </div>
    </a>
    <div class="dropdown-divider"></div>

    <!-- 管理後台選項 -->
    @if (showAdminPanel) {
    <a routerLink="/admin/dashboard" class="dropdown-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-2">
        <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7">
        </path>
      </svg>
      @if (isSuperAdmin) {
      <span>超級管理後台</span>
      } @else {
      <span>系統管理後台</span>
      }
    </a>
    <div class="dropdown-divider"></div>
    }

    <!-- 會員中心 -->
    <a routerLink="/profile" class="dropdown-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-2">
        <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0"></path>
        <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
      </svg>
      會員中心
    </a>

    <!-- 設定 -->
    <a routerLink="/settings" class="dropdown-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-2">
        <path
          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
        </path>
        <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"></path>
      </svg>
      設定
    </a>

    <div class="dropdown-divider"></div>

    <!-- 登出 -->
    <a href="javascript:void(0)" (click)="onLogout(); $event.preventDefault()" class="dropdown-item text-danger">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-2">
        <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"></path>
        <path d="M9 12h12l-3 -3"></path>
        <path d="M18 15l3 -3"></path>
      </svg>
      登出
    </a>
  </div>
</div>
} @else {
<!-- 未登入：顯示登入按鈕 -->
<div class="nav-item">
  <a href="javascript:void(0)" (click)="navigateToLogin(); $event.preventDefault()"
    class="btn btn-primary d-flex align-items-center gap-2">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
      <path d="M9 8v-2a2 2 0 0 1 2 -2h7a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2v-2" />
      <path d="M3 12h13l-3 -3" />
      <path d="M13 15l3 -3" />
    </svg>
    登入
  </a>
</div>
}
