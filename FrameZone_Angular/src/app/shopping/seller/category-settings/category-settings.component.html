<div class="settings-container">
  <div class="settings-header">
    <div>
      <h1 class="settings-title">分類設定</h1>
      <p class="settings-subtitle">管理您的商品分類</p>
    </div>
    <button class="btn-add" (click)="openAddModal()">
      + 新增分類
    </button>
  </div>

  <!-- Category List -->
  <div class="category-list">
    <div class="list-header">
      <div class="header-col col-order">排序</div>
      <div class="header-col col-name">分類名稱</div>
      <div class="header-col col-count">商品數</div>
      <div class="header-col col-status">啟用</div>
      <div class="header-col col-actions">操作</div>
    </div>

    <div *ngFor="let category of categories; let i = index" class="list-item" [class.inactive]="!category.isActive">
      <div class="item-col col-order">
        <div class="order-controls">
          <button class="order-btn" [disabled]="i === 0" (click)="moveUp(category)" title="向上移動">
            ▲
          </button>
          <button class="order-btn" [disabled]="i === categories.length - 1" (click)="moveDown(category)" title="向下移動">
            ▼
          </button>
        </div>
      </div>

      <div class="item-col col-name">
        <span class="category-name">{{ category.name }}</span>
      </div>

      <div class="item-col col-count">
        <span class="product-count">{{ category.productCount }}</span>
      </div>

      <div class="item-col col-status">
        <label class="toggle-switch">
          <input type="checkbox" [checked]="category.isActive" (change)="toggleCategory(category)">
          <span class="slider"></span>
        </label>
      </div>

      <div class="item-col col-actions">
        <button class="action-btn" (click)="openEditModal(category)" title="編輯">
          ✏️ 編輯
        </button>
        <button class="action-btn delete" (click)="confirmDelete(category)" title="刪除">
          🗑️ 刪除
        </button>
      </div>
    </div>

    <div *ngIf="categories.length === 0" class="empty-state">
      <div class="empty-icon">📂</div>
      <h3>尚未建立分類</h3>
      <p>建立第一個分類來組織您的商品</p>
      <button class="btn-add" (click)="openAddModal()">+ 新增分類</button>
    </div>
  </div>
</div>

<!-- Add/Edit Category Modal -->
<div class="modal-overlay" *ngIf="showCategoryModal" (click)="closeModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? '編輯分類' : '新增分類' }}</h2>
      <button class="btn-close" (click)="closeModal()">✕</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label>分類名稱 *</label>
        <input type="text" [(ngModel)]="modalCategory.name" placeholder="例如: 服飾配件" autofocus>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="modalCategory.isActive">
          <span>啟用此分類</span>
        </label>
      </div>

      <div class="divider"></div>

      <div class="products-section">
        <div class="section-header-with-search">
          <h3 class="section-subtitle">
            選擇商品
            <span class="selected-count">(已選 {{ getSelectedProductsCount() }} 個)</span>
          </h3>
          <input type="text" [(ngModel)]="searchKeyword" placeholder="搜尋商品名稱或 SKU" class="search-input-small">
        </div>

        <div class="product-selection-list">
          <div *ngFor="let product of filteredProducts" class="product-item"
            [class.selected]="isProductSelected(product.id)" (click)="toggleProduct(product.id)">
            <div class="product-checkbox">
              <input type="checkbox" [checked]="isProductSelected(product.id)" (click)="$event.stopPropagation()">
            </div>
            <div class="product-image-small">
              <img [src]="product.image" [alt]="product.name">
            </div>
            <div class="product-details">
              <div class="product-name-small">{{ product.name }}</div>
              <div class="product-meta-small">
                <span class="product-sku">{{ product.sku }}</span>
                <span class="product-price-small">NT$ {{ product.price }}</span>
              </div>
            </div>
          </div>

          <div *ngIf="filteredProducts.length === 0" class="empty-products">
            <p>找不到符合的商品</p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeModal()">取消</button>
      <button class="btn-primary" (click)="saveCategory()">
        {{ isEditMode ? '儲存' : '新增' }}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="showDeleteModal = false">
  <div class="modal-content small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>確認刪除</h2>
      <button class="btn-close" (click)="showDeleteModal = false">✕</button>
    </div>

    <div class="modal-body">
      <div class="delete-warning">
        <div class="warning-icon">⚠️</div>
        <p>確定要刪除 <strong>{{ categoryToDelete?.name }}</strong> 分類嗎?</p>
        <p class="warning-text">此操作無法復原</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="showDeleteModal = false">取消</button>
      <button class="btn-danger" (click)="deleteCategory()">確認刪除</button>
    </div>
  </div>
</div>
